<!-- ============================================================
     PAGE : page_accueil
     MODULE : Dashboard d‚Äôaccueil ‚Äî RP Business System
     VERSION : PRO 2026
============================================================ -->

<div class="page-container">

  <!-- SECTION 1 ‚Äî BIENVENUE -->
  <section class="card">
    <h1>üëã Bienvenue</h1>
    <p id="accueil_nom">Chargement du joueur‚Ä¶</p>
    <p id="accueil_role">R√¥le : ‚Ä¶</p>
  </section>

  <!-- SECTION 2 ‚Äî INFORMATIONS RP -->
  <section class="card">
    <h2>üßç Votre personnage</h2>
    <div id="accueil_personnage">Chargement‚Ä¶</div>

    <h2>üè¢ Votre entreprise</h2>
    <div id="accueil_entreprise">Chargement‚Ä¶</div>
  </section>

  <!-- SECTION 3 ‚Äî STATISTIQUES -->
  <section class="card">
    <h2>üìä Statistiques du syst√®me</h2>
    <ul id="accueil_stats">
      <li>Joueurs : ‚Ä¶</li>
      <li>Entreprises : ‚Ä¶</li>
      <li>Emplois : ‚Ä¶</li>
      <li>Grades : ‚Ä¶</li>
      <li>Employ√©s : ‚Ä¶</li>
    </ul>
  </section>

  <!-- SECTION 4 ‚Äî ACTIONS RAPIDES -->
  <section class="card">
    <h2>‚ö° Actions rapides</h2>
    <div id="accueil_actions">Chargement‚Ä¶</div>
  </section>

</div>

<script>

  /* ============================================================
     CHARGEMENT DU JOUEUR LOCAL
     ============================================================ */
  function loadLocalPlayerAccueil() {
    const data = localStorage.getItem("rp_player");
    return data ? JSON.parse(data) : null;
  }

  /* ============================================================
     INITIALISATION DE LA PAGE
     ============================================================ */
  function initAccueil() {
    const player = loadLocalPlayerAccueil();

    // Nom RP
    if (player) {
      document.getElementById("accueil_nom").innerHTML =
        `<b>${player.nom} ${player.prenom}</b>`;
    } else {
      document.getElementById("accueil_nom").innerHTML =
        "<span style='color:#ff6666;'>Aucun joueur local enregistr√©.</span>";
    }

    // R√¥le
    google.script.run
      .withSuccessHandler(role => {
        document.getElementById("accueil_role").innerHTML = "R√¥le : <b>" + role + "</b>";
        loadActionsRapides(role);
      })
      .ui_getUserRole();

    // Infos RP
    if (player) {
      google.script.run
        .withSuccessHandler(ent => {
          if (ent) {
            document.getElementById("accueil_entreprise").innerHTML =
              `üëë Patron de : <b>${ent.entreprise}</b>`;
          } else {
            document.getElementById("accueil_entreprise").innerHTML =
              "Aucune entreprise.";
          }
        })
        .ui_checkIfPlayerIsPatron(player.nom, player.prenom);

      document.getElementById("accueil_personnage").innerHTML =
        `<b>${player.nom} ${player.prenom}</b>`;
    }

    // Stats syst√®me
    google.script.run
      .withSuccessHandler(stats => {
        document.getElementById("accueil_stats").innerHTML = `
          <li>Joueurs : <b>${stats.joueurs}</b></li>
          <li>Entreprises : <b>${stats.entreprises}</b></li>
          <li>Emplois : <b>${stats.emplois}</b></li>
          <li>Grades : <b>${stats.grades}</b></li>
          <li>Employ√©s : <b>${stats.employes}</b></li>
        `;
      })
      .ui_getSystemStats();
  }

  /* ============================================================
     ACTIONS RAPIDES
     ============================================================ */
  function loadActionsRapides(role) {
    const zone = document.getElementById("accueil_actions");

    let html = "";

    if (role === "admin_principal" || role === "admin_secondaire") {
      html += `<button onclick="loadPage('page_admin_panel')">Ouvrir Admin Panel</button><br>`;
      html += `<button onclick="loadPage('page_entreprises')">Cr√©er une entreprise</button><br>`;
      html += `<button onclick="loadPage('page_joueurs')">Cr√©er un joueur</button><br>`;
    }

    if (role === "joueur") {
      html += `<button onclick="loadPage('page_joueurs')">Voir mon personnage</button><br>`;
    }

    zone.innerHTML = html || "Aucune action disponible.";
  }

  /* ============================================================
     LANCEMENT
     ============================================================ */
  initAccueil();

</script>