<script>
/****************************************************
 * script_totaux.html
 * --------------------------------------------------
 * Gestion des totaux :
 *  - Total global (montant de lâ€™opÃ©ration)
 *  - Remise
 *  - Livraison
 *
 * âš ï¸ IMPORTANT :
 *  On NE met plus Ã  jour :
 *    - totalLegal
 *    - totalIllegal
 *
 *  Ces valeurs viennent UNIQUEMENT de la feuille Compta.
 ****************************************************/

/****************************************************
 * ðŸ§® updateTotalGlobal()
 * --------------------------------------------------
 * Calcule uniquement :
 *   - totalGlobal = somme des lignes Â± remise + livraison
 *
 * Ne touche PAS :
 *   - #totalLegal
 *   - #totalIllegal
 ****************************************************/
function updateTotalGlobal() {
  console.log("ðŸ”„ Recalcul du total globalâ€¦");

  const lignes = document.querySelectorAll("#articlesTable tbody tr");

  let totalOperation = 0;

  lignes.forEach(tr => {
    const total = Number(tr.querySelector(".total-ligne")?.textContent) || 0;
    totalOperation += total;
  });

  // Remise
  const remise = Number(document.getElementById("remise")?.value) || 0;

  // Livraison
  const livraison = Number(document.getElementById("livraison")?.value) || 0;

  // Total global = total des articles - remise + livraison
  const totalGlobal = totalOperation - remise + livraison;

  const globalBox = document.getElementById("totalGlobal");
  if (globalBox) {
    globalBox.textContent = totalGlobal.toFixed(2) + " $";
    console.log("ðŸ§® Total global mis Ã  jour :", totalGlobal);
  }

  // â— NE PAS TOUCHER totalLegal / totalIllegal ici
  // Ils sont mis Ã  jour uniquement via updateComptaUI()
}

/****************************************************
 * ðŸŽ§ Ã‰couteurs sÃ©curisÃ©s (DOM prÃªt)
 ****************************************************/
window.addEventListener("DOMContentLoaded", () => {
  const remise = document.getElementById("remise");
  const livraison = document.getElementById("livraison");

  if (remise) remise.addEventListener("input", updateTotalGlobal);
  if (livraison) livraison.addEventListener("input", updateTotalGlobal);
});
</script>
