<script>
/********************************************************************
 * @file script_init_html.html
 * @description Initialisation globale du front :
 *              - Attente du DOM
 *              - Chargement de lâ€™interface HOME
 *              - Chargement des donnÃ©es CAISSE (backend)
 *              - DÃ©marrage de lâ€™horloge
 *
 * Auteur : Stephen
 * Version : 1.2.0
 * Mis Ã  jour : 2026-02-10 â€¢ 10:42 (CET)
 *
 * Historique interne :
 *   - 2026-02-10 : Stabilisation complÃ¨te de lâ€™ordre de chargement
 *   - 2026-02-10 : Ajout des logs structurÃ©s
 *   - 2026-02-10 : Correction initInterface() non dÃ©fini
 *   - 2026-02-10 : Correction du chargement des donnÃ©es caisse
 *
 * Notes :
 *   - Ce script DOIT Ãªtre chargÃ© en DERNIER dans index.html
 *   - Ne contient aucune logique mÃ©tier
 *   - Ne doit jamais appeler de fonctions avant DOMContentLoaded
 ********************************************************************/

console.log("ğŸ“„ [INIT_HTML] script_init_html chargÃ©");

window.addEventListener("DOMContentLoaded", () => {
  console.log("ğŸš€ [INIT_HTML] DOM prÃªt â†’ lancement de l'initialisation globale");

  /************************************************************
   * 1) Initialisation de lâ€™interface
   ************************************************************/
  try {
    if (typeof initInterface === "function") {
      console.log("â–¶ï¸ [INIT_HTML] Appel initInterface()â€¦");
      initInterface();
      console.log("ğŸŸ© [INIT_HTML] initInterface() exÃ©cutÃ© avec succÃ¨s");
    } else {
      console.error("ğŸ’¥ [INIT_HTML] initInterface() introuvable !");
    }
  } catch (err) {
    console.error("ğŸ’¥ [INIT_HTML] ERREUR dans initInterface()");
    console.error(err);
  }

  /************************************************************
   * 2) Chargement des donnÃ©es CAISSE
   ************************************************************/
  try {
    console.log("ğŸ“¡ [INIT_HTML] Chargement des donnÃ©es caisseâ€¦");

    google.script.run
      .withSuccessHandler(initCaisse)
      .getInitialDataCaisse();

    console.log("ğŸŸ© [INIT_HTML] Appel getInitialDataCaisse() envoyÃ©");
  } catch (err) {
    console.error("ğŸ’¥ [INIT_HTML] ERREUR appel getInitialDataCaisse()");
    console.error(err);
  }

  /************************************************************
   * 3) DÃ©marrage de lâ€™horloge
   ************************************************************/
  try {
    if (typeof startClock === "function") {
      console.log("â–¶ï¸ [INIT_HTML] DÃ©marrage horlogeâ€¦");
      startClock();
      console.log("ğŸŸ© [INIT_HTML] startClock() exÃ©cutÃ© avec succÃ¨s");
    } else {
      console.error("ğŸ’¥ [INIT_HTML] startClock() introuvable !");
    }
  } catch (err) {
    console.error("ğŸ’¥ [INIT_HTML] ERREUR dans startClock()");
    console.error(err);
  }

  console.log("ğŸ [INIT_HTML] Initialisation globale terminÃ©e");
});
</script>
