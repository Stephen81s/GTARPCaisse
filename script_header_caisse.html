<script>
/********************************************************************
 *  FICHIER : script_header_caisse.html
 *  MODULE  : HEADER â€” Affichage des montants lÃ©gale / illÃ©gale
 * ------------------------------------------------------------------
 *  RÃ”LES :
 *    - Afficher les montants de la caisse lÃ©gale et illÃ©gale
 *      dans le header, Ã  droite des boutons de navigation.
 *    - Aucun clic, aucune interaction : purement visuel.
 *    - Mise Ã  jour automatique via initCaisse(data).
 *
 *  Auteur : Stephen
 *  Version : 1.0.0
 *  Date    : 2026-02-10
 ********************************************************************/


/********************************************************************
 * ðŸ§¾ [HEADER_CAISSE] Mise Ã  jour du header (montants lÃ©gale/illÃ©gale)
 * ------------------------------------------------------------------
 * AppelÃ© depuis initCaisse(data)
 * Met Ã  jour les Ã©lÃ©ments :
 *   - #navLegal
 *   - #navIllegal
 ********************************************************************/
function majHeaderCaisses(data) {
  console.log("ðŸ§¾ [HEADER_CAISSE] Mise Ã  jour des montantsâ€¦");

  if (!data || !data.compta) {
    console.warn("âš ï¸ [HEADER_CAISSE] DonnÃ©es compta manquantes.");
    return;
  }

  const legal   = Number(data.compta.totalLegal)   || 0;
  const illegal = Number(data.compta.totalIllegal) || 0;

  // Mise Ã  jour du DOM
  const elLegal   = document.getElementById("navLegal");
  const elIllegal = document.getElementById("navIllegal");

  if (!elLegal || !elIllegal) {
    console.error("âŒ [HEADER_CAISSE] Ã‰lÃ©ments DOM introuvables (#navLegal / #navIllegal)");
    return;
  }

  elLegal.textContent   = legal.toFixed(2)   + " $";
  elIllegal.textContent = illegal.toFixed(2) + " $";

  console.log("ðŸŸ© [HEADER_CAISSE] Montants mis Ã  jour :", {
    legal: legal,
    illegal: illegal
  });
}


/********************************************************************
 * ðŸ§© [HEADER_CAISSE] Fonction utilitaire pour forcer un refresh
 * ------------------------------------------------------------------
 * Appel manuel possible si tu veux rafraÃ®chir le header ailleurs.
 ********************************************************************/
function refreshHeaderCaisse() {
  console.log("ðŸ”„ [HEADER_CAISSE] Refresh manuel demandÃ©â€¦");

  google.script.run
    .withSuccessHandler(data => {
      console.log("ðŸ“¥ [HEADER_CAISSE] DonnÃ©es reÃ§ues :", data);
      majHeaderCaisses(data);
    })
    .withFailureHandler(err => {
      console.error("ðŸ’¥ [HEADER_CAISSE] Erreur refresh :", err);
    })
    .getInitialDataCaisse();
}

</script>
