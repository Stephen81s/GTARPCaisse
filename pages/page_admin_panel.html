/* ============================================================
   FICHIER : admin_panel.js
   MODULE  : Admin Panel â€” RP Business System
   VERSION : PRO 2026
   AUTEUR  : Stephen + Copilot PRO
   ------------------------------------------------------------
   DESCRIPTION :
   GÃ¨re toutes les actions administratives :
     - CrÃ©ation de joueurs
     - CrÃ©ation dâ€™entreprises
     - RafraÃ®chissement des caches
     - Reconstruction des types RP
     - Reconstruction complÃ¨te du systÃ¨me
     - Affichage des logs
   ------------------------------------------------------------
   LOGS :
   ğŸŸ¦ [admin] Module Admin Panel chargÃ©.
   ============================================================ */

console.log("ğŸŸ¦ [admin] Module Admin Panel chargÃ©.");

const adminPanel = {

  /* ------------------------------------------------------------
     UTILITAIRE â€” Ajoute un message dans la zone de logs
     ------------------------------------------------------------ */
  log(msg) {
    const box = document.getElementById("admin_logs");
    if (!box) {
      console.error("âŒ [admin] Zone #admin_logs introuvable.");
      return;
    }

    const time = new Date().toLocaleTimeString();
    box.textContent += `[${time}] ${msg}\n`;
  },

  /* ------------------------------------------------------------
     CRÃ‰ATION â€” Joueur
     ------------------------------------------------------------ */
  async createJoueur() {
    const nom = document.getElementById("admin_nom").value.trim();
    const prenom = document.getElementById("admin_prenom").value.trim();

    if (!nom || !prenom) {
      this.log("âŒ Impossible de crÃ©er un joueur : champs incomplets.");
      return;
    }

    this.log(`ğŸ§ CrÃ©ation du joueur : ${prenom} ${nom}â€¦`);

    try {
      const result = await api("admin_createJoueur", { nom, prenom });
      this.log(`ğŸŸ© Joueur crÃ©Ã© : ${JSON.stringify(result)}`);
    } catch (err) {
      this.log(`âŒ Erreur crÃ©ation joueur : ${err}`);
    }
  },

  /* ------------------------------------------------------------
     CRÃ‰ATION â€” Entreprise
     ------------------------------------------------------------ */
  async createEntreprise() {
    const nom = document.getElementById("admin_ent_nom").value.trim();
    const type = document.getElementById("admin_ent_type").value.trim();

    if (!nom || !type) {
      this.log("âŒ Impossible de crÃ©er une entreprise : champs incomplets.");
      return;
    }

    this.log(`ğŸ¢ CrÃ©ation entreprise : ${nom} (${type})â€¦`);

    try {
      const result = await api("admin_createEntreprise", { nom, type });
      this.log(`ğŸŸ© Entreprise crÃ©Ã©e : ${JSON.stringify(result)}`);
    } catch (err) {
      this.log(`âŒ Erreur crÃ©ation entreprise : ${err}`);
    }
  },

  /* ------------------------------------------------------------
     OUTILS â€” RafraÃ®chir les caches
     ------------------------------------------------------------ */
  async refreshCaches() {
    this.log("ğŸ”„ RafraÃ®chissement des cachesâ€¦");

    try {
      const result = await api("admin_refreshCaches");
      this.log(`ğŸŸ© Caches rafraÃ®chis : ${JSON.stringify(result)}`);
    } catch (err) {
      this.log(`âŒ Erreur refresh caches : ${err}`);
    }
  },

  /* ------------------------------------------------------------
     OUTILS â€” Recharger les types RP
     ------------------------------------------------------------ */
  async rebuildTypes() {
    this.log("ğŸ“š Reconstruction des types RPâ€¦");

    try {
      const result = await api("admin_rebuildTypes");
      this.log(`ğŸŸ© Types RP reconstruits : ${JSON.stringify(result)}`);
    } catch (err) {
      this.log(`âŒ Erreur rebuild types : ${err}`);
    }
  },

  /* ------------------------------------------------------------
     OUTILS â€” Reconstruction complÃ¨te du systÃ¨me
     ------------------------------------------------------------ */
  async rebuildAll() {
    this.log("âš™ï¸ Reconstruction complÃ¨te du systÃ¨meâ€¦");

    try {
      const result = await api("admin_rebuildAll");
      this.log(`ğŸŸ© Reconstruction terminÃ©e : ${JSON.stringify(result)}`);
    } catch (err) {
      this.log(`âŒ Erreur rebuild all : ${err}`);
    }
  },

  /* ------------------------------------------------------------
     OUTILS â€” Afficher les logs systÃ¨me
     ------------------------------------------------------------ */
  async showLogs() {
    this.log("ğŸ“œ RÃ©cupÃ©ration des logs systÃ¨meâ€¦");

    try {
      const logs = await api("admin_getLogs");
      this.log(`ğŸŸ© Logs systÃ¨me :\n${logs.join("\n")}`);
    } catch (err) {
      this.log(`âŒ Erreur rÃ©cupÃ©ration logs : ${err}`);
    }
  }
};