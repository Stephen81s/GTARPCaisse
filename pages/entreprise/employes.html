<!-- ============================================================
     FICHIER : pages/entreprise/employes.html
     ARCHITECTURE : RP MANAGER — PRO 2026
     MODULE : Gestion des employés
     DESCRIPTION :
        - Liste des employés
        - Ajout / édition / suppression
        - Gestion du grade
     AUTEUR : Stephen
     ============================================================ -->

<section class="page-container">

    <!-- TITRE + ACTIONS -->
    <h1 class="page-title">Employés</h1>

    <button class="btn-primary" onclick="openEmployeModal()">
        + Ajouter un employé
    </button>

    <!-- TABLE EMPLOYÉS -->
    <table class="pro-table" id="table-employes">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nom RP</th>
                <th>Identifiant</th>
                <th>Grade</th>
                <th>Actif</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rempli dynamiquement -->
        </tbody>
    </table>

</section>

<!-- MODAL EMPLOYÉ -->
<div id="employe-modal" class="modal hidden">
    <div class="modal-content">

        <h2 id="employe-modal-title">Nouvel employé</h2>

        <label>Nom RP</label>
        <input type="text" id="emp-nom" />

        <label>Identifiant (ID joueur)</label>
        <input type="text" id="emp-identifiant" />

        <label>Grade</label>
        <select id="emp-grade"></select>

        <label>Actif</label>
        <select id="emp-actif">
            <option value="1">Oui</option>
            <option value="0">Non</option>
        </select>

        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeEmployeModal()">Annuler</button>
            <button class="btn-primary" onclick="saveEmploye()">Enregistrer</button>
        </div>

    </div>
</div>

<style>
    .page-container {
        padding: 30px;
    }

    .page-title {
        margin-bottom: 20px;
    }

    .btn-primary {
        background: #0078ff;
        color: white;
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        margin-bottom: 20px;
    }

    .btn-secondary {
        background: #ccc;
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
    }

    .pro-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .pro-table th,
    .pro-table td {
        padding: 12px;
        border-bottom: 1px solid #ddd;
    }

    .pro-table th {
        background: #f5f5f5;
        text-align: left;
    }

    .modal {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.4);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .modal.hidden {
        display: none;
    }

    .modal-content {
        background: white;
        padding: 25px;
        border-radius: 10px;
        width: 350px;
    }

    .modal-content input,
    .modal-content select {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
    }

    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
</style>

<script>
let editingEmployeId = null;

/***************************************************************
 * INITIALISATION
 ***************************************************************/
async function init_employes() {
    await loadGrades();
    loadEmployes();
}

/***************************************************************
 * CHARGEMENT DES GRADES
 ***************************************************************/
async function loadGrades() {
    const grades = await apiCall("api_getGrades");

    const select = document.getElementById("emp-grade");
    select.innerHTML = "";

    grades.forEach(g => {
        const opt = document.createElement("option");
        opt.value = g.id;
        opt.textContent = g.nom;
        select.appendChild(opt);
    });
}

/***************************************************************
 * CHARGEMENT DES EMPLOYÉS
 ***************************************************************/
async function loadEmployes() {
    const data = await apiCall("api_getEmployes");

    const tbody = document.querySelector("#table-employes tbody");
    tbody.innerHTML = "";

    data.forEach(e => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${e.id}</td>
            <td>${e.nom}</td>
            <td>${e.identifiant}</td>
            <td>${e.grade_nom}</td>
            <td>${e.actif ? "Oui" : "Non"}</td>
            <td>
                <button onclick="editEmploye('${e.id}')">Modifier</button>
                <button onclick="deleteEmploye('${e.id}')">Supprimer</button>
            </td>
        `;

        tbody.appendChild(tr);
    });
}

/***************************************************************
 * MODAL
 ***************************************************************/
function openEmployeModal() {
    editingEmployeId = null;
    document.getElementById("employe-modal-title").textContent = "Nouvel employé";
    document.getElementById("emp-nom").value = "";
    document.getElementById("emp-identifiant").value = "";
    document.getElementById("emp-grade").value = "";
    document.getElementById("emp-actif").value = "1";
    document.getElementById("employe-modal").classList.remove("hidden");
}

function closeEmployeModal() {
    document.getElementById("employe-modal").classList.add("hidden");
}

/***************************************************************
 * EDITION
 ***************************************************************/
async function editEmploye(id) {
    const e = await apiCall("api_getEmployeById", id);

    editingEmployeId = id;
    document.getElementById("employe-modal-title").textContent = "Modifier employé";
    document.getElementById("emp-nom").value = e.nom;
    document.getElementById("emp-identifiant").value = e.identifiant;
    document.getElementById("emp-grade").value = e.grade_id;
    document.getElementById("emp-actif").value = e.actif ? "1" : "0";
    document.getElementById("employe-modal").classList.remove("hidden");
}

/***************************************************************
 * SAUVEGARDE
 ***************************************************************/
async function saveEmploye() {
    const nom = document.getElementById("emp-nom").value;
    const identifiant = document.getElementById("emp-identifiant").value;
    const grade_id = document.getElementById("emp-grade").value;
    const actif = document.getElementById("emp-actif").value === "1";

    if (!nom || !identifiant || !grade_id) {
        showError("Veuillez remplir tous les champs obligatoires");
        return;
    }

    if (editingEmployeId) {
        await apiCall("api_updateEmploye", editingEmployeId, { nom, identifiant, grade_id, actif });
        showSuccess("Employé mis à jour");
    } else {
        await apiCall("api_createEmploye", { nom, identifiant, grade_id, actif });
        showSuccess("Employé créé");
    }

    closeEmployeModal();
    loadEmployes();
}

/***************************************************************
 * SUPPRESSION
 ***************************************************************/
async function deleteEmploye(id) {
    if (!confirm("Supprimer cet employé ?")) return;

    await apiCall("api_deleteEmploye", id);
    showSuccess("Employé supprimé");
    loadEmployes();
}
</script>